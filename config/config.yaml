# ============================================
# Database Configuration File
# ============================================
# This file contains configuration for all supported databases.
# Uncomment the database section you want to use.

# ============================================
# ACTIVE DATABASE CONFIGURATION
# ============================================
# Choose one: postgres, mysql, or sqlite

database:
  # Database type (postgres, mysql, sqlite)
  type: sqlite
  
  # Connection pool settings (applies to all databases)
  max_idle_conns: 10
  max_open_conns: 100
  conn_max_lifetime: 1h      # Maximum lifetime of a connection
  conn_max_idle_time: 10m    # Maximum idle time before closing
  
  # GORM settings
  log_level: info            # Options: silent, error, warn, info
  prepare_stmt: true         # Enable prepared statement cache
  skip_default_txn: true     # Skip default transaction for better performance

# ============================================
# POSTGRESQL CONFIGURATION
# ============================================
# Recommended for production use
# Features: Advanced indexing, JSONB support, full-text search

postgres:
  host: localhost
  port: 5432
  user: postgres
  password: postgres
  dbname: social_media
  sslmode: disable           # Options: disable, require, verify-ca, verify-full
  
  # For production, use environment variables:
  # host: ${DB_HOST}
  # port: ${DB_PORT}
  # user: ${DB_USER}
  # password: ${DB_PASSWORD}
  # dbname: ${DB_NAME}
  # sslmode: ${DB_SSLMODE}

# ============================================
# MYSQL CONFIGURATION
# ============================================
# Good alternative with wide ecosystem support
# Features: Good performance, replication support

mysql:
  host: localhost
  port: 3306
  user: root
  password: root
  dbname: social_media
  charset: utf8mb4           # Recommended for emoji support
  
  # Additional MySQL parameters (add to DSN automatically):
  # - parseTime=True (for time.Time support)
  # - loc=Local (for timezone handling)
  
  # For production, use environment variables:
  # host: ${DB_HOST}
  # port: ${DB_PORT}
  # user: ${DB_USER}
  # password: ${DB_PASSWORD}
  # dbname: ${DB_NAME}
  # charset: ${DB_CHARSET}

# ============================================
# SQLITE CONFIGURATION
# ============================================
# Perfect for development and testing
# Features: Zero configuration, embedded database

sqlite:
  filepath: ./data/social_media.db
  
  # SQLite automatically creates the database file if it doesn't exist
  # The directory must exist before running the application
  
  # For different environments:
  # Development: ./data/social_media_dev.db
  # Testing: ./data/social_media_test.db
  # Production: Not recommended for production use

# ============================================
# ENVIRONMENT-SPECIFIC CONFIGURATIONS
# ============================================

# Development environment
development:
  database:
    type: sqlite
  sqlite:
    filepath: ./data/social_media_dev.db
  log_level: info
  prepare_stmt: false        # Disable for easier debugging

# Testing environment
testing:
  database:
    type: sqlite
  sqlite:
    filepath: ./data/social_media_test.db
  log_level: error           # Reduce noise in tests
  prepare_stmt: true

# Staging environment
staging:
  database:
    type: postgres
  postgres:
    host: staging-db.example.com
    port: 5432
    user: ${DB_USER}
    password: ${DB_PASSWORD}
    dbname: social_media_staging
    sslmode: require
  log_level: warn
  max_idle_conns: 5
  max_open_conns: 50

# Production environment
production:
  database:
    type: postgres
  postgres:
    host: ${DB_HOST}
    port: ${DB_PORT}
    user: ${DB_USER}
    password: ${DB_PASSWORD}
    dbname: ${DB_NAME}
    sslmode: verify-full
  log_level: error           # Only log errors in production
  max_idle_conns: 20
  max_open_conns: 200
  conn_max_lifetime: 2h
  conn_max_idle_time: 15m
  prepare_stmt: true
  skip_default_txn: true

# ============================================
# MIGRATION SETTINGS
# ============================================

migrations:
  auto_migrate: true         # Automatically run migrations on startup
  seed_data: false           # Don't seed in production
  create_indexes: true       # Create additional indexes

# ============================================
# REDIS CONFIGURATION (for caching)
# ============================================

redis:
  enable: true
  host: localhost
  port: 6379
  password: ""               # Leave empty if no password
  db: 0                      # Database number (0-15)
  pool_size: 10
  min_idle_conns: 5
  
  # For production:
  # host: ${REDIS_HOST}
  # port: ${REDIS_PORT}
  # password: ${REDIS_PASSWORD}

# ============================================
# APPLICATION SETTINGS
# ============================================

app:
  name: social-media-platform
  version: 1.0.0
  environment: development   # development, testing, staging, production
  port: 8080
  
  # Feature flags
  features:
    enable_caching: true
    enable_rate_limiting: true
    enable_analytics: false

# ============================================
# NOTES & BEST PRACTICES
# ============================================

# 1. DATABASE SELECTION GUIDE:
#    - Development: SQLite (fast, no setup)
#    - Testing: SQLite (isolated, fast)
#    - Staging: PostgreSQL (production-like)
#    - Production: PostgreSQL (best performance, features)
#
# 2. NEVER commit passwords or sensitive data to version control
#    - Use environment variables in production
#    - Use .env files locally (add to .gitignore)
#    - Use secrets management (AWS Secrets Manager, HashiCorp Vault)
#
# 3. CONNECTION POOL SIZING:
#    - max_open_conns should be less than your database's connection limit
#    - For PostgreSQL default (100 connections):
#      - Development: 10-20 connections
#      - Production: 80-100 connections (leave buffer for admin)
#    - Formula: max_open_conns = (available_connections - buffer) / number_of_app_instances
#
# 4. SSL/TLS IN PRODUCTION:
#    - Always use sslmode=require or higher for PostgreSQL
#    - Use encrypted connections for MySQL (ssl-mode=REQUIRED)
#
# 5. PERFORMANCE TUNING:
#    - Enable prepare_stmt for better performance
#    - Set skip_default_txn=true if you handle transactions manually
#    - Adjust conn_max_lifetime based on your database settings
#
# 6. MONITORING:
#    - Log slow queries (set log_level appropriately)
#    - Monitor connection pool stats
#    - Set up database monitoring (Prometheus, Datadog, etc.)

# ============================================
# DOCKER COMPOSE EXAMPLE
# ============================================
# If using Docker, here's a quick setup:
#
# services:
#   postgres:
#     image: postgres:14-alpine
#     environment:
#       POSTGRES_USER: postgres
#       POSTGRES_PASSWORD: postgres
#       POSTGRES_DB: social_media
#     ports:
#       - "5432:5432"
#     volumes:
#       - postgres_data:/var/lib/postgresql/data
#
#   mysql:
#     image: mysql:8.0
#     environment:
#       MYSQL_ROOT_PASSWORD: root
#       MYSQL_DATABASE: social_media
#     ports:
#       - "3306:3306"
#     volumes:
#       - mysql_data:/var/lib/mysql
#
#   redis:
#     image: redis:7-alpine
#     ports:
#       - "6379:6379"
#     volumes:
#       - redis_data:/data
#
# volumes:
#   postgres_data:
#   mysql_data:
#   redis_data: